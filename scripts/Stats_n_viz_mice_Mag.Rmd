---
title: "stats_n_viz_mice"
output: html_document
date: "2024-05-15"
---

```{r}
library(ggplot2)
library(dplyr)
# load in average DMN angles
DMNAngs=read.csv('~/Downloads/mice_magsMerged_mice_LSD.csv',header=F)


# Rename the columns for easier reference
colnames(DMNAngs) <- c("V1", paste0("V", 2:ncol(DMNAngs)))

# remove incompoelte pt
#DMNAngs=DMNAngs[DMNAngs$V1!='m7507',]

# Reshape the data to long format using base R
DMNAngs_long <- reshape(DMNAngs, 
                        varying = list(names(DMNAngs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(DMNAngs), 
                        direction = "long")

# Adjust the timepoint to start from 1
DMNAngs_long$Timepoint <- DMNAngs_long$Timepoint - 1

# Reset row names
rownames(DMNAngs_long) <- NULL

# plot it out
ggplot(DMNAngs_long, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point(size=4) +
  scale_color_viridis_d(option = "plasma") +
  labs(x = "Timepoint", y = "% Bottom-up", color = "Variable",title='LSD') +
  theme_minimal(base_size=25)+geom_vline(xintercept=1.5,linetype='dashed')

# add drug value and test standalone
DMNAngs_long$Drug=1
DMNAngs_long$Drug[DMNAngs_long$Timepoint==1]=0
# remove any NA values
DMNAngs_long=na.omit(DMNAngs_long)

fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = DMNAngs_long)
summary(fit_lme)

### and make plain figure version without longitudinal lines (Fig 2A)
# sep. pre and post
DMNAngs_long$TP=NULL
DMNAngs_long$TP[DMNAngs_long$Timepoint==1]='pre'
DMNAngs_long$TP[DMNAngs_long$Timepoint>1]='LSD'
# reorder it
DMNAngs_long$TP <- factor(DMNAngs_long$TP, levels = c('pre', 'LSD'))
ggplot(DMNAngs_long, aes(x = TP, y = Value)) +
  geom_jitter(width = 0.25, height = 0, alpha = 0.5,size=4) +  # Jittered points
  geom_boxplot(alpha = 0.2,outlier.shape = NA) +     # Boxplot
  labs(title = "LSD vs. No-drug scans \n",
       x = "",
       y = "% Bottom-up") + scale_x_discrete(labels=c('Pre','LSD'))+
  theme_minimal(base_size=25)


# for equivalence to nature paper use timepoint 1 and 5 for dichotomous binarization of drug/nondrug
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=2,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=3,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=4,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=6,]
DMNAngs_long$Timepoint[DMNAngs_long$Timepoint==1]=0
DMNAngs_long$Timepoint[DMNAngs_long$Timepoint==5]=1

# equivalent plot
ggplot(DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1)) +
  geom_point(size = 4) +
  geom_line() +
  
  scale_color_viridis_d(option = "plasma") +
  theme_minimal(base_size = 22)+ylab(paste0('Degrees from Bottom-up'))+xlab('LSD (mice)')

boxplot_data_left <- DMNAngs_long %>%
  filter(Timepoint == unique(DMNAngs_long$Timepoint)[1])

boxplot_data_right <- DMNAngs_long %>%
  filter(Timepoint == unique(DMNAngs_long$Timepoint)[2])

# Plotting with boxplots
ggplot() +
  # Scatter plot and lines
  geom_point(data = DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1), size = 4) +
  geom_line(data = DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1)) +
  # Box plot on the left side
  geom_boxplot(data = boxplot_data_left, aes(x = as.numeric(Timepoint) - 0.5, y = Value, group = Timepoint), width = 0.2, outlier.shape = NA, color = "black") +
  # Box plot on the right side
  geom_boxplot(data = boxplot_data_right, aes(x = as.numeric(Timepoint) + 0.5, y = Value, group = Timepoint), width = 0.2, outlier.shape = NA, color = "black") +
  # Custom color scale
  scale_color_viridis_d(option = "plasma") +
  # Theme and labels
  theme_minimal(base_size = 22) +
  ylab('% Bottom-up') +
  xlab('LSD (mice)') +
  labs(color='mice')+
  # Adjust the x-axis limits to accommodate the box plots
  scale_x_continuous(breaks = unique(as.numeric(DMNAngs_long$Timepoint)), limits = c(min(as.numeric(DMNAngs_long$Timepoint)) - 1, max(as.numeric(DMNAngs_long$Timepoint)) + 1))



```



```{r}
library(ggplot2)
library(dplyr)
######## DIAZEPAM

# load in average DMN angles
DMNAngs=read.csv('~/Downloads/mice_magsMerged_mice_Diaz.csv',header=F)


# Rename the columns for easier reference
colnames(DMNAngs) <- c("V1", paste0("V", 2:ncol(DMNAngs)))

# remove incompoelte pt
#DMNAngs=DMNAngs[DMNAngs$V1!='m7507',]

# Reshape the data to long format using base R
DMNAngs_long <- reshape(DMNAngs, 
                        varying = list(names(DMNAngs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(DMNAngs), 
                        direction = "long")

# Adjust the timepoint to start from 1
DMNAngs_long$Timepoint <- DMNAngs_long$Timepoint - 1

# Reset row names
rownames(DMNAngs_long) <- NULL

# add drug value and test standalone
DMNAngs_long$Drug=1
DMNAngs_long$Drug[DMNAngs_long$Timepoint==1]=0
# remove any NA values
DMNAngs_long=na.omit(DMNAngs_long)

fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = DMNAngs_long)
summary(fit_lme)

### and make plain figure version without longitudinal lines (Fig 2A)
# sep. pre and post
DMNAngs_long$TP=NULL
DMNAngs_long$TP[DMNAngs_long$Timepoint==1]='pre'
DMNAngs_long$TP[DMNAngs_long$Timepoint>1]='Diazepam'
# reorder it
DMNAngs_long$TP <- factor(DMNAngs_long$TP, levels = c('pre', 'Diazepam'))
ggplot(DMNAngs_long, aes(x = TP, y = Value)) +
  geom_jitter(width = 0.25, height = 0, alpha = 0.5,size=4) +  # Jittered points
  geom_boxplot(alpha = 0.2,outlier.shape = NA) +     # Boxplot
  labs(title = "Diazepam vs. No-drug scans \n",
       x = "",
       y = "% Bottom-up") + scale_x_discrete(labels=c('Pre','Diazepam'))+
  theme_minimal(base_size=25)


# for equivalence to nature paper use timepoint 1 and 5 for dichotomous binarization of drug/nondrug
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=2,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=3,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=4,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=6,]
DMNAngs_long$Timepoint[DMNAngs_long$Timepoint==1]=0
DMNAngs_long$Timepoint[DMNAngs_long$Timepoint==5]=1

# equivalent plot
ggplot(DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1)) +
  geom_point(size = 4) +
  geom_line() +
  
  scale_color_viridis_d(option = "plasma") +
  theme_minimal(base_size = 22)+ylab(paste0('Degrees from Bottom-up'))+xlab('Diazepam (mice)')

boxplot_data_left <- DMNAngs_long %>%
  filter(Timepoint == unique(DMNAngs_long$Timepoint)[1])

boxplot_data_right <- DMNAngs_long %>%
  filter(Timepoint == unique(DMNAngs_long$Timepoint)[2])

# Plotting with boxplots
ggplot() +
  # Scatter plot and lines
  geom_point(data = DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1), size = 4) +
  geom_line(data = DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1)) +
  # Box plot on the left side
  geom_boxplot(data = boxplot_data_left, aes(x = as.numeric(Timepoint) - 0.5, y = Value, group = Timepoint), width = 0.2, outlier.shape = NA, color = "black") +
  # Box plot on the right side
  geom_boxplot(data = boxplot_data_right, aes(x = as.numeric(Timepoint) + 0.5, y = Value, group = Timepoint), width = 0.2, outlier.shape = NA, color = "black") +
  # Custom color scale
  scale_color_viridis_d(option = "plasma") +
  # Theme and labels
  theme_minimal(base_size = 22) +
  ylab('% Bottom-up') +
  xlab('Diazepam (mice)') +
  labs(color='mice')+
  # Adjust the x-axis limits to accommodate the box plots
  scale_x_continuous(breaks = unique(as.numeric(DMNAngs_long$Timepoint)), limits = c(min(as.numeric(DMNAngs_long$Timepoint)) - 1, max(as.numeric(DMNAngs_long$Timepoint)) + 1))
```

```{r}
library(ggplot2)
library(dplyr)

######## DEXMEDETOMIDINE

# load in average DMN angles
DMNAngs=read.csv('~/Downloads/mice_magsMerged_mice_Dex.csv',header=F)


# Rename the columns for easier reference
colnames(DMNAngs) <- c("V1", paste0("V", 2:ncol(DMNAngs)))

# remove incompoelte pt
#DMNAngs=DMNAngs[DMNAngs$V1!='m7507',]

# Reshape the data to long format using base R
DMNAngs_long <- reshape(DMNAngs, 
                        varying = list(names(DMNAngs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(DMNAngs), 
                        direction = "long")

# Adjust the timepoint to start from 1
DMNAngs_long$Timepoint <- DMNAngs_long$Timepoint - 1

# Reset row names
rownames(DMNAngs_long) <- NULL

# plot it out
ggplot(DMNAngs_long, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point(size=4) +
  scale_color_viridis_d(option = "plasma") +
  labs(x = "Timepoint", y = "% Bottom-up", color = "Variable",title='Dexmedetomidine') +
  theme_minimal(base_size=25)+geom_vline(xintercept=1.5,linetype='dashed')

# add drug value and test standalone
DMNAngs_long$Drug=1
DMNAngs_long$Drug[DMNAngs_long$Timepoint==1]=0
# remove any NA values
DMNAngs_long=na.omit(DMNAngs_long)

fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = DMNAngs_long)
summary(fit_lme)

### and make plain figure version without longitudinal lines (Fig 2A)
# sep. pre and post
DMNAngs_long$TP=NULL
DMNAngs_long$TP[DMNAngs_long$Timepoint==1]='pre'
DMNAngs_long$TP[DMNAngs_long$Timepoint>1]='Dexmedetomidine'
# reorder it
DMNAngs_long$TP <- factor(DMNAngs_long$TP, levels = c('pre', 'Dexmedetomidine'))
ggplot(DMNAngs_long, aes(x = TP, y = Value)) +
  geom_jitter(width = 0.25, height = 0, alpha = 0.5,size=4) +  # Jittered points
  geom_boxplot(alpha = 0.2,outlier.shape = NA) +     # Boxplot
  labs(title = "Dexmedetomidine vs. No-drug scans \n",
       x = "",
       y = "% Bottom-up") + scale_x_discrete(labels=c('Pre','Dexmedetomidine'))+
  theme_minimal(base_size=25)


# for equivalence to nature paper use timepoint 1 and 5 for dichotomous binarization of drug/nondrug
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=2,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=3,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=4,]
DMNAngs_long=DMNAngs_long[DMNAngs_long$Timepoint!=6,]
DMNAngs_long$Timepoint[DMNAngs_long$Timepoint==1]=0
DMNAngs_long$Timepoint[DMNAngs_long$Timepoint==5]=1

# equivalent plot
ggplot(DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1)) +
  geom_point(size = 4) +
  geom_line() +
  
  scale_color_viridis_d(option = "plasma") +
  theme_minimal(base_size = 22)+ylab(paste0('Degrees from Bottom-up'))+xlab('Dexmedetomidine (mice)')

boxplot_data_left <- DMNAngs_long %>%
  filter(Timepoint == unique(DMNAngs_long$Timepoint)[1])

boxplot_data_right <- DMNAngs_long %>%
  filter(Timepoint == unique(DMNAngs_long$Timepoint)[2])

# Plotting with boxplots
ggplot() +
  # Scatter plot and lines
  geom_point(data = DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1), size = 4) +
  geom_line(data = DMNAngs_long, aes(x = Timepoint, y = Value, group = V1, color = V1)) +
  # Box plot on the left side
  geom_boxplot(data = boxplot_data_left, aes(x = as.numeric(Timepoint) - 0.5, y = Value, group = Timepoint), width = 0.2, outlier.shape = NA, color = "black") +
  # Box plot on the right side
  geom_boxplot(data = boxplot_data_right, aes(x = as.numeric(Timepoint) + 0.5, y = Value, group = Timepoint), width = 0.2, outlier.shape = NA, color = "black") +
  # Custom color scale
  scale_color_viridis_d(option = "plasma") +
  # Theme and labels
  theme_minimal(base_size = 22) +
  ylab('% Bottom-up') +
  xlab('Dexmedetomidine (mice)') +
  labs(color='mice')+
  # Adjust the x-axis limits to accommodate the box plots
  scale_x_continuous(breaks = unique(as.numeric(DMNAngs_long$Timepoint)), limits = c(min(as.numeric(DMNAngs_long$Timepoint)) - 1, max(as.numeric(DMNAngs_long$Timepoint)) + 1))
```
```{r}
# let's merge them all into one set to test for any interactions
### LSD ###
# load in average DMN angles
DMNAngsLSD=read.csv('~/Downloads/mice_magsMerged_mice_LSD.csv',header=F)
# Rename the columns for easier reference
colnames(DMNAngsLSD) <- c("V1", paste0("V", 2:ncol(DMNAngsLSD)))
# Reshape the data to long format using base R
DMNAngsLSD_long <- reshape(DMNAngsLSD, 
                        varying = list(names(DMNAngsLSD)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(DMNAngsLSD), 
                        direction = "long")

# Adjust the timepoint to start from 1
DMNAngsLSD_long$Timepoint <- DMNAngsLSD_long$Timepoint - 1
# add drug value and test standalone
DMNAngsLSD_long$Drug=1
DMNAngsLSD_long$Drug[DMNAngsLSD_long$Timepoint==1]=0
# set drug
DMNAngsLSD_long$WhichDrug='LSD'

### DIAZEPAM ###
# load in average DMN angles
DMNAngsDiaz=read.csv('~/Downloads/mice_magsMerged_mice_Diaz.csv',header=F)
# Rename the columns for easier reference
colnames(DMNAngsDiaz) <- c("V1", paste0("V", 2:ncol(DMNAngsDiaz)))
# Reshape the data to long format using base R
DMNAngsDiaz_long <- reshape(DMNAngsDiaz, 
                        varying = list(names(DMNAngsDiaz)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(DMNAngsDiaz), 
                        direction = "long")

# Adjust the timepoint to start from 1
DMNAngsDiaz_long$Timepoint <- DMNAngsDiaz_long$Timepoint - 1
# add drug value and test standalone
DMNAngsDiaz_long$Drug=1
DMNAngsDiaz_long$Drug[DMNAngsDiaz_long$Timepoint==1]=0
# set drug
DMNAngsDiaz_long$WhichDrug='Diaz'

### Dexmedetomidine ###
# load in average DMN angles
DMNAngsDex=read.csv('~/Downloads/mice_magsMerged_mice_Dex.csv',header=F)
# Rename the columns for easier reference
colnames(DMNAngsDex) <- c("V1", paste0("V", 2:ncol(DMNAngsDex)))
# Reshape the data to long format using base R
DMNAngsDex_long <- reshape(DMNAngsDex, 
                        varying = list(names(DMNAngsDex)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(DMNAngsDex), 
                        direction = "long")

# Adjust the timepoint to start from 1
DMNAngsDex_long$Timepoint <- DMNAngsDex_long$Timepoint - 1
# add drug value and test standalone
DMNAngsDex_long$Drug=1
DMNAngsDex_long$Drug[DMNAngsDex_long$Timepoint==1]=0
# set drug
DMNAngsDex_long$WhichDrug='Dex'


# merge 'em all
masterMousedf=rbind(DMNAngsLSD_long,DMNAngsDiaz_long)
# rename mouse col
colnames(masterMousedf)[1]<-'mouse'
# bottom-up percentage col
colnames(masterMousedf)[3]<-'BUP'
# remove NA rows
masterMousedf <- masterMousedf[!is.na(masterMousedf$BUP), ]
# relevel LSD to be reference
masterMousedf$WhichDrug<-as.factor(masterMousedf$WhichDrug)
masterMousedf$Drug<-as.factor(masterMousedf$Drug)
masterMousedf <- within(masterMousedf, WhichDrug <- relevel(WhichDrug, ref = 2))
# mixed effect model
fit_lme <- lme(BUP ~ Drug*WhichDrug, random = ~ 1 | mouse, data = masterMousedf)
summary(fit_lme)
plot_model(fit_lme,type='int',title='% bottom-up by Drug')
```

```{r}
masterMouseAll=rbind(DMNAngsLSD_long,DMNAngsDiaz_long,DMNAngsDex_long)
masterMouseAll$WhichDrug2=NULL
masterMouseAll$WhichDrug2[masterMouseAll$Drug==0]='No Drug'
masterMouseAll$WhichDrug2[masterMouseAll$WhichDrug=='Dex' & masterMouseAll$Drug==1]='Active Control'
masterMouseAll$WhichDrug2[masterMouseAll$WhichDrug=='Diaz' & masterMouseAll$Drug==1]='Active Control'
masterMouseAll$WhichDrug2[masterMouseAll$WhichDrug=='LSD' & masterMouseAll$Drug==1]='Psychedelic'

# remove na rows
masterMouseAll=masterMouseAll[!is.na(masterMouseAll$Value),]

# make donut plot
masterMouseAll$Drug<-as.factor(masterMouseAll$WhichDrug2)
donutData<- data.frame(
  Category=levels(masterMouseAll$Drug),
  count=tabulate(masterMouseAll$Drug)
)

# convert labels to be consistent across studies
donutData$Category=c('Active Control','No Drug','Psychedelic')

# percentages
donutData$frac = donutData$count / sum(donutData$count)

# Compute the cumulative for plotting
donutData$ymax = cumsum(donutData$frac)

# Compute the bottom of each rectangle (plotted as rectangle and coord_polar'ed)
donutData$ymin = c(0, head(donutData$ymax, n=-1))
 
# plot
ggplot(donutData, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=Category)) +
     geom_rect() +
     coord_polar(theta="y") + 
     xlim(c(1, 4)) + theme_classic(base_size=28)+theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.line = element_blank()
  )+guides(fill = guide_legend(title = NULL))+scale_fill_manual(values = c("#EF9500","#002642","#840032"))


```

```{r}
### and make a No-drug vs. LSD plot
# remove NA rows
masterMouseAll=masterMouseAll[!is.na(masterMouseAll$Value),]

# sep. pre and post
masterMouseAll$TP=NULL
masterMouseAll$TP[masterMouseAll$Timepoint==1]='No Drug'
masterMouseAll$TP[masterMouseAll$Timepoint>1 & masterMouseAll$WhichDrug=='LSD']='LSD'

# make a drug nodrug DF
masterMouseDnD=masterMouseAll[!is.na(masterMouseAll$TP),]

# model it
fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = masterMouseDnD)

# reorder it
masterMouseDnD$TP <- factor(masterMouseDnD$TP, levels = c('No Drug', 'LSD'))
ggplot(masterMouseDnD, aes(x = TP, y = Value)) +
  geom_jitter(width = 0.25, height = 0, alpha = 0.8,size=4,aes(color=V1)) +  # Jittered points
  geom_boxplot(alpha = 0.2,outlier.shape = NA) +     # Boxplot
  labs(title = "LSD vs. No-drug scans \n",
       x = "",
       y = "Avg. Magnitude in DMN") + scale_x_discrete(labels=c('No Drug','LSD'))+
  theme_minimal(base_size=25)

# copy in color scheme
library(ggplot2)
library(grDevices)

# Define the extended custom palette function
extended_palette <- colorRampPalette(rev(c("#FFEE00", "#EF9500", "#002642", "#c1004f", "#000000")))

# Generate a palette with the number of unique levels in V1
num_colors <- length(unique(masterMouseAll$V1))
generated_colors <- extended_palette(num_colors)

# get unique mouse names
unique_values <- unique(masterMouseAll$V1)
new_labels <- paste0("m", seq_along(unique_values))
names(new_labels) <- unique_values

# Replace the values in V1 using the new labels
masterMouseAll$V1 <- new_labels[masterMouseAll$V1]

# make a drug nodrug DF
masterMouseDnD=masterMouseAll[!is.na(masterMouseAll$TP),]


# final ordering
masterMouseDnD$TP <- factor(masterMouseDnD$TP, levels = c('No Drug', 'LSD'))
masterMouseDnD$Mice <- factor(masterMouseDnD$V1, levels = new_labels)

# Figure 2, bottom
ggplot(masterMouseDnD, aes(x = TP, y = Value)) +
  geom_jitter(width = 0.25, height = 0, alpha = 0.8, size = 4, aes(color = Mice)) +  # Jittered points
  geom_boxplot(alpha = 0.2, outlier.shape = NA) +     # Boxplot
  labs(title = "LSD vs. No-drug scans \n",
       x = "",
       y = "Avg. Magnitude in DMN") +
  scale_x_discrete(labels = c('No Drug', 'LSD')) +
  scale_color_manual(values = generated_colors) +  # Custom generated color palette
  theme_minimal(base_size = 28)+theme(axis.title.y = element_text(size = 22))


```




```{r}
# plot LSD time series
# extract LSD
DMNAngs_long=masterMouseAll[masterMouseAll$WhichDrug=='LSD',]
# create minutes column
DMNAngs_long$Minutes=(DMNAngs_long$Timepoint-1.5)*5
ggplot(DMNAngs_long, aes(x = Minutes, y = Value,  group = V1)) +
  geom_line() +
  geom_point(size=4,aes(color=V1)) +
  scale_color_viridis_d(option = "plasma") +
  labs(x = "Minutes", y = "Avg. Magnitude", color = "Mouse",title='LSD') +
  theme_minimal(base_size=25)+geom_vline(xintercept=0,linetype='dashed')+scale_color_manual(values = generated_colors)+
  theme(axis.title.y = element_text(size = 22))




```




```{r}
library(ggplot2)
library(viridis)

# Define the extended custom palette function
extended_palette <- colorRampPalette(rev(c("#FFEE00", "#EF9500", "#002642", "#c1004f", "#000000")))

# Generate a palette with the number of unique levels in V1
unique_values <- unique(masterMouseAll$V1)
num_colors <- length(unique_values)
generated_colors <- extended_palette(num_colors)

# Create a named vector for the colors
names(generated_colors) <- unique_values

# Function to plot data
plot_data <- function(data, title) {
  ggplot(data, aes(x = Minutes, y = Value, group = V1)) +
    geom_line() +
    geom_point(size = 4, aes(color = V1)) +
    labs(x = "Minutes", y = "Avg. Magnitude", color = "Mouse", title = title) +
    theme_minimal(base_size = 25) +
    geom_vline(xintercept = 0, linetype = 'dashed') +
    scale_color_manual(values = generated_colors)+theme(axis.title.y = element_text(size = 22))
}

# Extract LSD data
DMNAngs_long_LSD <- masterMouseAll[masterMouseAll$WhichDrug == 'LSD',]
# Create minutes column
DMNAngs_long_LSD$Minutes <- (DMNAngs_long_LSD$Timepoint - 1.5) * 5
# Plot LSD data
plot_lsd <- plot_data(DMNAngs_long_LSD, 'LSD')
print(plot_lsd)

# Extract Dex data
DMNAngs_long_Dex <- masterMouseAll[masterMouseAll$WhichDrug == 'Dex',]
# Create minutes column
DMNAngs_long_Dex$Minutes <- (DMNAngs_long_Dex$Timepoint - 1.5) * 5
# Plot Dex data
plot_dex <- plot_data(DMNAngs_long_Dex, 'Dexmedetomidine')
print(plot_dex)

# extract Diaz
DMNAngs_long=masterMouseAll[masterMouseAll$WhichDrug=='Diaz',]
# create minutes column
DMNAngs_long$Minutes=(DMNAngs_long$Timepoint-1.5)*5
plot_diaz <- plot_data(DMNAngs_long, 'Diazepam')
print(plot_diaz)

```



























```{r}
# load in average BUP durations
BUPFreqs=read.csv('~/Downloads/mice_AngDur_Merged_mice_LSD.csv',header=F)


# Rename the columns for easier reference
colnames(BUPFreqs) <- c("V1", paste0("V", 2:ncol(BUPFreqs)))

# remove incompoelte pt
#DMNAngs=DMNAngs[DMNAngs$V1!='m7507',]

# Reshape the data to long format using base R
BUPFreqs <- reshape(BUPFreqs, 
                        varying = list(names(BUPFreqs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(BUPFreqs), 
                        direction = "long")

# Adjust the timepoint to start from 1
BUPFreqs$Timepoint <- BUPFreqs$Timepoint - 1

# Reset row names
rownames(BUPFreqs) <- NULL

# plot it out
ggplot(BUPFreqs, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point(size=4) +
  scale_color_viridis_d(option = "plasma") +
  labs(x = "Timepoint", y = "Mean BUP Duration (Frames)", color = "Variable") +
  theme_minimal(base_size=25)+geom_vline(xintercept=1.5,linetype='dashed')

# add drug values
BUPFreqs$Drug=1
BUPFreqs$Drug[BUPFreqs$Timepoint==1]=0
# remove any NA values
BUPFreqs=na.omit(BUPFreqs)

fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = BUPFreqs)
summary(fit_lme)

```

```{r}
# load in average BUP durations
BUPFreqs=read.csv('~/Downloads/mice_AngFreq_Merged_mice_LSD.csv',header=F)


# Rename the columns for easier reference
colnames(BUPFreqs) <- c("V1", paste0("V", 2:ncol(BUPFreqs)))

# remove incompoelte pt
#DMNAngs=DMNAngs[DMNAngs$V1!='m7507',]

# Reshape the data to long format using base R
BUPFreqs <- reshape(BUPFreqs, 
                        varying = list(names(BUPFreqs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(BUPFreqs), 
                        direction = "long")

# Adjust the timepoint to start from 1
BUPFreqs$Timepoint <- BUPFreqs$Timepoint - 1

# Reset row names
rownames(BUPFreqs) <- NULL

# plot it out
ggplot(BUPFreqs, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point(size=4) +
  scale_color_viridis_d(option = "plasma") +
  labs(x = "Timepoint", y = "BUP Occurences", color = "Variable") +
  theme_minimal(base_size=25)+geom_vline(xintercept=1.5,linetype='dashed')

# add drug values
BUPFreqs$Drug=1
BUPFreqs$Drug[BUPFreqs$Timepoint==1]=0
# remove any NA values
BUPFreqs=na.omit(BUPFreqs)

fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = BUPFreqs)
summary(fit_lme)

```
```{r}
# load in average TD durations
BUPFreqs=read.csv('~/Downloads/mice_AngDur_Merged_mice_LSD_TD.csv',header=F)


# Rename the columns for easier reference
colnames(BUPFreqs) <- c("V1", paste0("V", 2:ncol(BUPFreqs)))

# remove incompoelte pt
#DMNAngs=DMNAngs[DMNAngs$V1!='m7507',]

# Reshape the data to long format using base R
BUPFreqs <- reshape(BUPFreqs, 
                        varying = list(names(BUPFreqs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(BUPFreqs), 
                        direction = "long")

# Adjust the timepoint to start from 1
BUPFreqs$Timepoint <- BUPFreqs$Timepoint - 1

# Reset row names
rownames(BUPFreqs) <- NULL

# plot it out
ggplot(BUPFreqs, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point(size=4) +
  scale_color_viridis_d(option = "plasma") +
  labs(x = "Timepoint", y = "Mean TD Duration (Frames)", color = "Variable") +
  theme_minimal(base_size=25)+geom_vline(xintercept=1.5,linetype='dashed')

# add drug values
BUPFreqs$Drug=1
BUPFreqs$Drug[BUPFreqs$Timepoint==1]=0
# remove any NA values
BUPFreqs=na.omit(BUPFreqs)

fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = BUPFreqs)
summary(fit_lme)

```

```{r}
# load in average BUP durations
BUPFreqs=read.csv('~/Downloads/mice_AngFreq_Merged_mice_LSD_TD.csv',header=F)


# Rename the columns for easier reference
colnames(BUPFreqs) <- c("V1", paste0("V", 2:ncol(BUPFreqs)))

# remove incompoelte pt
#DMNAngs=DMNAngs[DMNAngs$V1!='m7507',]

# Reshape the data to long format using base R
BUPFreqs <- reshape(BUPFreqs, 
                        varying = list(names(BUPFreqs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(BUPFreqs), 
                        direction = "long")

# Adjust the timepoint to start from 1
BUPFreqs$Timepoint <- BUPFreqs$Timepoint - 1

# Reset row names
rownames(BUPFreqs) <- NULL

# plot it out
ggplot(BUPFreqs, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point(size=4) +
  scale_color_viridis_d(option = "plasma") +
  labs(x = "Timepoint", y = "TD Occurences", color = "Variable") +
  theme_minimal(base_size=25)+geom_vline(xintercept=1.5,linetype='dashed')

# add drug values
BUPFreqs$Drug=1
BUPFreqs$Drug[BUPFreqs$Timepoint==1]=0
# remove any NA values
BUPFreqs=na.omit(BUPFreqs)

fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = BUPFreqs)
summary(fit_lme)

```

# NOTE BELOW CODE ASSUMES INCOMPLETE MOUSE IS EXCLUDED

# load in planars
planars=read.delim('~/Planar_mouse_LSD5.txt',sep=',',header=F)
planars$mice=DMNAngs$V1
planars <- planars[, c("mice","V1","V2","V3","V4","V5","V6")]
# Reshape the data to long format using base R
planars_long <- reshape(planars, 
                        varying = list(names(planars)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(planars), 
                        direction = "long")
# Adjust the timepoint to start from 1
planars_long$Timepoint <- planars_long$Timepoint - 1

ggplot(planars_long, aes(x = Timepoint, y = Value, color = mice, group = mice)) +
  geom_line() +
  geom_point() +
  labs(title = "# planar waves", x = "Timepoint", y = "Value", color = "Variable") +
  theme_minimal()

# test basic cor
colnames(planars_long)=c('mice','Timepoint','Waves','id')
combined=cbind(DMNAngs_long,planars_long)
# add drug column to see above and beyond assoc
combined$Drug=1
combined$Drug[combined$Timepoint==1]=0
combined$Drug<-as.factor(combined$Drug)
# association seems to carry above and beyond drug
fit_lme <- lme(Value ~ Waves+Drug, random = ~ 1 | V1, data = combined)
summary(fit_lme)
# raw association
fit_lme <- lme(Value ~ Waves, random = ~ 1 | V1, data = combined)


# load in complexity
Complx=read.csv('~/Downloads/mice_Complexity_mice_LSD(1).csv',header=F)


# Rename the columns for easier reference
colnames(Complx) <- c("V1", paste0("V", 2:ncol(Complx)))

# Reshape the data to long format using base R
Complx_long <- reshape(Complx, 
                        varying = list(names(Complx)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(Complx), 
                        direction = "long")

# Adjust the timepoint to start from 1
Complx_long$Timepoint <- Complx_long$Timepoint - 1

# Reset row names
rownames(Complx_long) <- NULL

# remove incompoelte pt
#Complx_long=Complx_long[Complx_long$V1!='m7507',]

# plot it out
ggplot(Complx_long, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point() +
  labs(title = "Complexity: LSD", x = "Timepoint", y = "Value", color = "Variable") +
  theme_minimal()


fit_lme <- lme(Value ~ Timepoint, random = ~ 1 | V1, data = Complx_long)


# combined
# test basic cor
colnames(Complx_long)=c('mice','Timepoint','Complexity','id')
colnames(DMNAngs_long)[1]<-'mice'
# First merge DMNAngs_long with planars_long
DMNAngs_long$mice<-as.factor(DMNAngs_long$mice)
planars_long$mice<-as.factor(planars_long$mice)
Complx_long$mice<-as.factor(Complx_long$mice)

combined1 <- merge(DMNAngs_long, planars_long, by = c('mice', 'Timepoint', 'id'))
# Then merge the result with Complx_long
combined <- merge(combined1, Complx_long, by = c('mice', 'Timepoint', 'id'))

# association seems to carry above and beyond drug
fit_lme <- lme(Complexity ~ Value+Drug+Waves, random = ~ 1 | mice, data = combined)
summary(fit_lme)
# raw association
fit_lme <- lme(Value ~ Waves, random = ~ 1 | V1, data = combined)

#standalone complexity
Complx_long$Drug=1
Complx_long$Drug[Complx_long$Timepoint==1]=0
fit_lme <- lme(Value ~ Drug, random = ~ 1 | V1, data = Complx_long)
summary(fit_lme)
```

```{r}
# chunk for ketamine
# load in average DMN angles
DMNAngs=read.csv('~/Downloads/mice_propsMerged_mice_ket.csv',header=F)


# Rename the columns for easier reference
colnames(DMNAngs) <- c("V1", paste0("V", 2:ncol(DMNAngs)))

# Reshape the data to long format using base R
DMNAngs_long <- reshape(DMNAngs, 
                        varying = list(names(DMNAngs)[-1]), 
                        v.names = "Value", 
                        timevar = "Timepoint", 
                        times = 2:ncol(DMNAngs), 
                        direction = "long")

# Adjust the timepoint to start from 1
DMNAngs_long$Timepoint <- DMNAngs_long$Timepoint - 1

# Reset row names
rownames(DMNAngs_long) <- NULL

# plot it out
ggplot(DMNAngs_long, aes(x = Timepoint, y = Value, color = V1, group = V1)) +
  geom_line() +
  geom_point() +
  labs(title = "Ketamine: Signal direction relative to Gradient of DMN", x = "Timepoint", y = "Value", color = "Variable") +
  theme_minimal()

```